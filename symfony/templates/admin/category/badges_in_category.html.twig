{% import 'macros.html.twig' as macros %}

{% if category.badges|length %}
    <div class="row">
        {% for badge in category.badges %}
            <div class="col-9 category-badge-{{ badge.id }}" style="padding:5px;">
                {{ macros.badge(badge) }}
            </div>

            <div class="col-3 category-badge-{{ badge.id }} text-right" style="padding:5px;">
                <div class="float-right">
                    <label class="switch">
                        <input type="checkbox"
                               class="toggle-visibility"
                               {% if badge.visibility %}checked{% endif %}
                               data-href="{{ path('admin_badge_toggle_visibility', {id: badge.id, token: csrf_token('token')}) }}"/>
                        <span class="slider"></span>
                    </label>

                    <a href="#"
                       data-id="{{ category.id }}"
                       data-confirm="{{ 'admin.category.badges_delete'|trans({'%name%': badge.name}) }}"
                       data-uri="{{ path('admin_category_delete_badge', {categoryId: category.id, badgeId: badge.id, token: csrf_token('token')}) }}"
                       data-row="category-badge-{{ badge.id }}"
                       class="btn btn-secondary delete-badge-from-category" style="border:1px solid red !important;">‚ùå</a>
                </div>
            </div>
        {% endfor %}
    </div>

    <hr/>
{% endif %}

<div class="text-center">
    <p>{{ 'admin.category.badges_add'|trans }}</p>
    <div id="badge-to-add">
        {{ render(controller('\\App\\Controller\\WidgetController::badgeEditor')) }}
    </div>
</div>

<script type="text/javascript">

    $('body')
        .off('change', '#badge-to-add input.flexdatalist')
        .on('change', '#badge-to-add input.flexdatalist', function () {
            if ($(this).val()) {
                $.post('{{ path('admin_category_add_badge', {id: category.id, token: csrf_token('token')}) }}', {
                    badge: $(this).val(),
                }, function (response) {
                    $('#category-badges .modal-body').html(response.body);
                    $('#category-badges .modal-body .flexdatalist').flexdatalist();
                    $.get('{{ path('admin_category_refresh', {id: category.id}) }}', function (html) {
                        $('#category-{{ category.id }}').html(html);
                    });
                });
            }
        });

</script>